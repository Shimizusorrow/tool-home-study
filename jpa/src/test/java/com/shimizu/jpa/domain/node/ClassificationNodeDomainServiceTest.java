package com.shimizu.jpa.domain.node;

import com.shimizu.jpa.repo.ClassificationNodeRepository;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.annotation.Rollback;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.context.junit.jupiter.SpringExtension;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.Stream;

import static org.junit.jupiter.api.Assertions.assertNotNull;

@ExtendWith(SpringExtension.class)
@SpringBootTest
@ActiveProfiles("junit")
@Rollback(value = false)
public class ClassificationNodeDomainServiceTest {
    @Autowired
    private ClassificationNodeRepository classificationNodeRepository;

    private static final String[][] data = new String[][]{
            {"1-层级一", "101", "1-层级二", "102", "1-层级三", "103", "1-层级四", "104"},
            {"2-层级一", "201", "2-层级二", "202", "2-层级三", "203", "2-层级四", "204"},
            {"3-层级一", "301", "3-层级二", "302", "3-层级三", "303", "3-层级四", "304"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"},
            {"3-层级一", "301", "3-层级二-1", "302-1", "3-层级三-1", "303-1", "3-层级四-1", "304-1"}
    };

    @Test
    void notNull() {
        assertNotNull(classificationNodeRepository);
    }

    @Test
    void findAll(){
        classificationNodeRepository.findByLevel(Level.FIRST.name());
    }

    @Test
    void test() {
        Stream.of(data).forEach(it -> {
            ClassificationNode first = new ClassificationNode(it[0], it[1], Level.FIRST);
            ClassificationNode second = new ClassificationNode(it[2], it[3], Level.SECOND);
            ClassificationNode third = new ClassificationNode(it[4], it[5], Level.THIRD);
            ClassificationNode fourth = new ClassificationNode(it[6], it[7], Level.FOURTH);

            ClassificationNode firstNode = classificationNodeRepository
                    .findByNameAndCode(first.getName(), first.getCode())
                    .orElse(new ClassificationNode(first));
            ClassificationNode secondNode = classificationNodeRepository
                    .findByNameAndCode(second.getName(), second.getCode())
                    .orElse(new ClassificationNode(second));
            ClassificationNode thirdNode = classificationNodeRepository
                    .findByNameAndCode(third.getName(), third.getCode())
                    .orElse(new ClassificationNode(third));
            ClassificationNode fourthNode = classificationNodeRepository
                    .findByNameAndCode(fourth.getName(), fourth.getCode())
                    .orElse(new ClassificationNode(fourth));

            if (!thirdNode.getNodes().contains(fourthNode)) {
                thirdNode.getNodes().add(fourthNode);
            }

            if (!secondNode.getNodes().contains(thirdNode)) {
                secondNode.getNodes().add(thirdNode);
            }

            if (!firstNode.getNodes().contains(secondNode)) {
                firstNode.getNodes().add(secondNode);
            }
            classificationNodeRepository.save(firstNode);
        });

//        nodes.stream()
//                .collect(Collectors.groupingBy(it -> it))
//                .entrySet()
//                .stream()
//                .peek(it -> {
//                    ClassificationNode key = it.getKey();
//                    key.getNodes().addAll(it.getValue());
//                })


    }


}

